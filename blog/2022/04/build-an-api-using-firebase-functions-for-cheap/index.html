<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=description content="It&rsquo;s easy to build an API using Firebase Functions for very little money"><meta name=author content="Edgar Román"><title>Build an API using Firebase Functions for cheap</title><link rel=canonical href=https://romandc.com/blog/2022/04/build-an-api-using-firebase-functions-for-cheap/><script defer data-domain=romandc.com src=https://plausible.io/js/plausible.js></script><meta property="og:title" content="Build an API using Firebase Functions for cheap"><meta property="og:description" content="It&rsquo;s easy to build an API using Firebase Functions for very little money"><meta property="og:type" content="article"><meta property="og:url" content="https://romandc.com/blog/2022/04/build-an-api-using-firebase-functions-for-cheap/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-04-29T00:00:00-04:00"><meta property="article:modified_time" content="2022-04-29T00:00:00-04:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Build an API using Firebase Functions for cheap"><meta name=twitter:description content="It&rsquo;s easy to build an API using Firebase Functions for very little money"><link rel=stylesheet href=https://romandc.com/css/styles.min.7bb47227462eeeebbc193a825e6cb168407c49db0d7c295e66664efe8532b8eb.css integrity=sha256-e7RyJ0Yu7uu8GTqCXmyxaEB8SdsNfCleZmZO/oUyuOs=></head><body><nav class=bg-gray-800><div class="max-w-7xl mx-auto px-2 sm:px-6 lg:px-8"><div class="relative flex items-center justify-between h-16"><div class="flex-1 flex items-center justify-center sm:items-stretch sm:justify-start"><div class="flex-shrink-0 flex items-center"><a href=https://romandc.com/ class="text-white font-semibold no-underline visited:text-white">Edgar Román</a></div></div><div class="hidden sm:block inset-y-0 right-0 flex space-x-4 items-center pr-2 sm:static sm:inset-auto sm:ml-6 sm:pr-0"><a href=/blog/ class="text-gray-300 hover:bg-gray-700 hover:text-white no-underline visited:text-white px-3 py-2 rounded-md text-sm font-medium">Blog</a>
<a href=/projects/ class="text-gray-300 hover:bg-gray-700 hover:text-white no-underline visited:text-white px-3 py-2 rounded-md text-sm font-medium">Projects</a>
<a href=/tags/ class="text-gray-300 hover:bg-gray-700 hover:text-white no-underline visited:text-white px-3 py-2 rounded-md text-sm font-medium">Tags</a>
<a href=/about/ class="text-gray-300 hover:bg-gray-700 hover:text-white no-underline visited:text-white px-3 py-2 rounded-md text-sm font-medium">About</a></div></div><div class="pb-4 flex flex-wrap justify-center space-x-6 sm:hidden"><a href=/blog/ class="text-gray-300 hover:bg-gray-700 hover:text-white no-underline visited:text-white px-3 py-2 rounded-md text-sm font-medium">Blog</a>
<a href=/projects/ class="text-gray-300 hover:bg-gray-700 hover:text-white no-underline visited:text-white px-3 py-2 rounded-md text-sm font-medium">Projects</a>
<a href=/tags/ class="text-gray-300 hover:bg-gray-700 hover:text-white no-underline visited:text-white px-3 py-2 rounded-md text-sm font-medium">Tags</a>
<a href=/about/ class="text-gray-300 hover:bg-gray-700 hover:text-white no-underline visited:text-white px-3 py-2 rounded-md text-sm font-medium">About</a></div></div></nav><main class=container><div class="relative py-0 bg-white overflow-hidden"><div class="relative px-4 sm:px-6 lg:px-8"><div class="text-lg max-w-prose mx-auto"><h1><span class="block text-3xl text-center leading-8 font-extrabold tracking-tight text-gray-900 sm:text-4xl">Build an API using Firebase Functions for cheap</span>
<span class="block text-base text-center text-indigo-600 font-semibold tracking-wide uppercase"><time datetime=" 2022-04-29T00:00:00-04:00">Fri Apr 29, 2022</time></span>
<span class="block text-base text-center text-indigo-600 font-semibold tracking-wide uppercase py-8"><i class="fa fa-tag" aria-hidden=true></i>
&nbsp;
<span class="inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium bg-blue-100 text-blue-800"><a href=/tags/firebase rel=tag>Firebase</a></span>
<span class="inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium bg-blue-100 text-blue-800"><a href=/tags/serverless rel=tag>Serverless</a></span>
<span class="inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium bg-blue-100 text-blue-800"><a href=/tags/cheap rel=tag>Cheap</a></span>
<span class="inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium bg-blue-100 text-blue-800"><a href=/tags/api rel=tag>API</a></span></span></h1><p>When I am working on personal projects, I often find the need to setup an API that serves up data to my
app or webpages. I get frustrated when I end up spending too much time on hosting and environment issues.</p><p>These days what I end up doing is hosting the API using <a href=https://firebase.google.com/docs/functions/>Cloud Functions for Firebase</a>. It hits all my requirements:</p><ul><li>Easy to setup</li><li>Serverless so no hosting setup and zero maintenance</li><li>Super cheap for low traffic projects</li></ul><h2 id=what-is-cloud-functions-for-firebase>What is Cloud Functions for Firebase?</h2><p>The official name is Cloud Functions for Firebase. In this article, I am going to call it Firebase Functions.
This is mostly to distinguish it from Google&rsquo;s <em>other</em> serverless function-as-a-service Cloud Functions. You
can read more about the <a href=https://cloud.google.com/functions/docs/concepts/functions-and-firebase>differences here</a>. From that page:</p><blockquote><p>You should use Cloud Functions for Firebase if you&rsquo;re a developer building a mobile app or mobile web app. Firebase gives mobile developers access to a complete range of fully managed mobile-centric services including analytics, authentication and Realtime Database. Cloud Functions rounds out the offering by providing a way to extend and connect the behavior of Firebase features through the addition of server-side code.</p></blockquote><p>While I&rsquo;m not going to write a mobile app in this article, I like to use Firebase Functions because:</p><ul><li>The local development experience is pretty good</li><li>Using other Firebase services like Firestore is easy to do</li></ul><p>If all this isn&rsquo;t confusing enough, Google is rolling out a new version of Cloud Functions called <a href=https://cloud.google.com/blog/products/serverless/introducing-the-next-generation-of-cloud-functions>2nd generation</a> which is in &ldquo;Public Preview&rdquo;.</p><h2 id=assumptions>Assumptions</h2><p>So in order to move forward, let&rsquo;s identify our working assumptions:</p><ol><li><p>We&rsquo;ll be writing the API in Javascript or Typescript</p><p>If you need another language like Python, check out other options like my course <a href=https://www.newline.co/courses/serverless-django-with-zappa>Serverless Django with Zappa</a>.</p></li><li><p>You have a working knowledge of API endpoints</p><p>You don&rsquo;t have to be an expert, but we aren&rsquo;t going into great depth in this article
about API design or event build more than a sample API using Express.js.<br>We&rsquo;ll just create a placeholder for you to fill.</p></li><li><p>The amount of traffic to this API will be low and will fall under the GCP free tier</p><p>You can find out more about limits on <a href=https://firebase.google.com/pricing/>the pricing page</a>. But you will need to sign up for the &lsquo;Blaze Plan&rsquo; which has a nominal cost of about $0.01 (for US, Canada, and India)</p></li><li><p>We won&rsquo;t connect to a database&mldr;yet</p><p>At least not in this article.</p></li></ol><h2 id=create-a-firebase-project>Create a Firebase Project</h2><ol><li>Sign up for a GCP account and upgrade to the &lsquo;Blaze Plan&rsquo;</li><li>Navigate to <a href=https://console.firebase.google.com/>https://console.firebase.google.com/</a> and click &lsquo;Add Project&rsquo;</li><li>On step 1, enter a name for your project</li><li>On step 2, disable Google Analytics for now, and click &lsquo;Create Project&rsquo;</li><li>Once in the project, click on &lsquo;Functions&rsquo; from the left menu</li><li>You&rsquo;ll have to click on &lsquo;Upgrade project&rsquo; to enable Firebase Functions<ul><li>Note that you can set a notification warning when expenses go over a certain amount. If you follow
this article, you should not be charged.</li></ul></li></ol><h2 id=setup-the-local-environment>Setup the local environment</h2><ol><li><p>You&rsquo;ll need to install the firebase tools globally
Either by using</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ npm install -g firebase-tools
</code></pre></div><p>or using <a href=https://volta.sh/>Volta</a>. As a side note, using Volta will allow you to install global javascript
tools as a non-root user. This is just my personal preference.</p></li><li><p>Start the firebase project by typing:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ firebase init
</code></pre></div></li><li><p>Next, you&rsquo;ll have to choose from an list of Firebase offerings. For now, just select <code>Functions</code> and <code>Emulators</code>.<br>Emulators will allow us to run our code locally for testing purposes.</p></li><li><p>Then select &ldquo;<code>Use an existing project</code>&rdquo; and select the newly created project.</p></li><li><p>Select <code>Javascript</code> and <em>no</em> to ESLint for now.</p></li><li><p>Select <em>Yes</em> to install npm dependencies</p></li><li><p>When asked which emulators to install, select <code>Functions</code></p></li><li><p>Use the default port of 5001</p></li><li><p>When asked about the emulator UI, select <em>No</em>. We don&rsquo;t need it right now and it sometimes is confusing. You can explore it later on your own.</p></li><li><p>Finally, you can download the emulator now.</p></li></ol><p>After all this is complete, you should have a single file called <code>firebase.json</code> and a directory called <code>functions</code>. The <code>functions</code> directory is where we&rsquo;ll write our API code.</p><h2 id=start-the-emulator>Start the emulator</h2><p>We&rsquo;ll take the emulator out for a spin.</p><ol><li><p>In the <code>functions</code> directory, open the <code>index.js</code> file and uncomment the sample code:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>functions</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;firebase-functions&#39;</span>)

<span style=color:#75715e>// // Create and Deploy Your First Cloud Functions
</span><span style=color:#75715e>// // https://firebase.google.com/docs/functions/write-firebase-functions
</span><span style=color:#75715e>//
</span><span style=color:#75715e></span><span style=color:#a6e22e>exports</span>.<span style=color:#a6e22e>helloWorld</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>functions</span>.<span style=color:#a6e22e>https</span>.<span style=color:#a6e22e>onRequest</span>((<span style=color:#a6e22e>request</span>, <span style=color:#a6e22e>response</span>) =&gt; {
    <span style=color:#a6e22e>functions</span>.<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39;Hello logs!&#39;</span>, { <span style=color:#a6e22e>structuredData</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span> })
    <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>send</span>(<span style=color:#e6db74>&#39;Hello from Firebase!&#39;</span>)
})
</code></pre></div></li><li><p>On your command line, type:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>firebase emulators:start
</code></pre></div><p>You should see something like:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>i  emulators: Starting emulators: functions
⚠  functions: The following emulators are not running, calls to these services from the Functions emulator will affect production: auth, firestore, database, hosting, pubsub, storage
✔  functions: Using node@16 from host.
⚠  emulators: The Emulator UI requires a project ID to start. Configure your default project with <span style=color:#e6db74>&#39;firebase use&#39;</span> or pass the --project flag.
i  functions: Watching <span style=color:#e6db74>&#34;/Users/newline/firebase-test1/functions&#34;</span> <span style=color:#66d9ef>for</span> Cloud Functions...
✔  functions<span style=color:#f92672>[</span>us-central1-helloWorld<span style=color:#f92672>]</span>: http <span style=color:#66d9ef>function</span> initialized <span style=color:#f92672>(</span>http://localhost:5001/firebase-test1/us-central1/helloWorld<span style=color:#f92672>)</span>.

┌─────────────────────────────────────────────────────────────┐
│ ✔  All emulators ready! It is now safe to connect your app. │
└─────────────────────────────────────────────────────────────┘

┌───────────┬────────────────┐
│ Emulator  │ Host:Port      │
├───────────┼────────────────┤
│ Functions │ localhost:5001 │
└───────────┴────────────────┘
Emulator Hub running at localhost:4400
Other reserved ports: <span style=color:#ae81ff>4500</span>

Issues? Report them at https://github.com/firebase/firebase-tools/issues and attach the *-debug.log files.
</code></pre></div></li><li><p>In the middle of all this text, find the localhost link. In this example, it&rsquo;s &ldquo;http://localhost:5001/firebase-test1/us-central1/helloWorld&rdquo;. Yours will be different. Open the link in a browser. You should see:</p></li></ol><p><img src=helloworld.png alt="Hello World"></p><p>Congrats, you have Firebase Functions working on your local system!
To exit the emulator, just type &lsquo;Ctrl-C&rsquo; at your terminal window.</p><h2 id=first-deployment>First Deployment</h2><p>This is all very exciting. Let&rsquo;s push our new &ldquo;hello world&rdquo; function into the cloud. From the
command line type:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>firebase deploy
</code></pre></div><p>The output should look similar, but not exactly to:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#f92672>===</span> Deploying to <span style=color:#e6db74>&#39;newline-test1&#39;</span>...

i  deploying functions
i  functions: ensuring required API cloudfunctions.googleapis.com is enabled...
i  functions: ensuring required API cloudbuild.googleapis.com is enabled...
⚠  functions: missing required API cloudbuild.googleapis.com. Enabling now...
✔  functions: required API cloudfunctions.googleapis.com is enabled
✔  functions: required API cloudbuild.googleapis.com is enabled
i  functions: preparing functions directory <span style=color:#66d9ef>for</span> uploading...
i  functions: packaged functions <span style=color:#f92672>(</span>50.13 KB<span style=color:#f92672>)</span> <span style=color:#66d9ef>for</span> uploading
✔  functions: functions folder uploaded successfully
i  functions: creating Node.js <span style=color:#ae81ff>16</span> <span style=color:#66d9ef>function</span> helloWorld<span style=color:#f92672>(</span>us-central1<span style=color:#f92672>)</span>...
✔  functions<span style=color:#f92672>[</span>helloWorld<span style=color:#f92672>(</span>us-central1<span style=color:#f92672>)]</span> Successful create operation.
Function URL <span style=color:#f92672>(</span>helloWorld<span style=color:#f92672>(</span>us-central1<span style=color:#f92672>))</span>: https://us-central1-newline-test1.cloudfunctions.net/helloWorld
i  functions: cleaning up build files...

✔  Deploy complete!

Project Console: https://console.firebase.google.com/project/newline-test1/overview
</code></pre></div><p>And if we navigate to the <code>Function URL</code> we should get the &lsquo;Hello from Firebase!&rsquo; message. Exciting!
Do you see how easy it is to create Firebase Functions?</p><h2 id=add-the-api-part>Add the API part</h2><p>We&rsquo;ve done all the hard part of setting up our local environment and the Firebase project. Let&rsquo;s jump
into creating an API using <a href=https://expressjs.com/>Express</a></p><p>Install express:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>npm install express
</code></pre></div><p>Next, edit the <code>index.js</code> file to look like:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>functions</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;firebase-functions&#39;</span>)

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>app</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;express&#39;</span>)() <span style=color:#75715e>// Note the shortcut here to get app initialized.  The extra ()
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>testHelloWorld</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
    <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>send</span>(<span style=color:#e6db74>&#39;Hello World!&#39;</span>)
}

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>testJSON</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
    <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>json</span>({ <span style=color:#a6e22e>message</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;You are awesome because you created an API&#39;</span>, <span style=color:#a6e22e>awesomeLevel</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>9000</span> })
}

<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/&#39;</span>, <span style=color:#a6e22e>testHelloWorld</span>)
<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/testJSON&#39;</span>, <span style=color:#a6e22e>testJSON</span>)

<span style=color:#a6e22e>exports</span>.<span style=color:#a6e22e>api</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>functions</span>.<span style=color:#a6e22e>https</span>.<span style=color:#a6e22e>onRequest</span>(<span style=color:#a6e22e>app</span>)
</code></pre></div><p>Then if you run</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>firebase emulators:start
</code></pre></div><p>You can load up your api locally. Note the URL link on the emulator is a little different &ndash; it should
have &lsquo;api&rsquo; added at the end like:</p><pre><code>http://localhost:5001/newline-test1/us-central1/api
</code></pre><p>You should see our &lsquo;Hello World&rsquo; message. Now for more fun, add &lsquo;/testJSON&rsquo; to the end of your link.
You should see the browser return back JSON data that our API has sent:</p><p><img src=jsondata.png alt="JSON Data"></p><p>Now finally, let&rsquo;s deploy to the cloud:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>firebase deploy
</code></pre></div><p>Note that when you try to deploy, Firebase is smart enough to detect that major changes to the URL structure
have occurred. You&rsquo;ll need to verify that you did indeed make these changes and everything is ok.
Since this is a trivial function, you can type <em>Yes</em>. Firebase will delete the old function we deployed
earlier and create a new one.</p><p>Once that completes, try to load the link and validate your API is now working!</p><h2 id=conclusion-and-next-steps>Conclusion and Next Steps</h2><p>This article has walked you through the basics of using Firebase Functions to host your own API.<br>The process of writing and creating a full featured API is beyond the scope of this article.
There are many resources out there to help with this task, but I hope you&rsquo;ll think about Firebase
Functions next time you are starting a project.</p></div></div></div></main><footer class=page-footer><div class="footer-copyright text-center py-3">©
<script>document.write((new Date).getFullYear())</script>&nbsp;<a href=/>Edgar Román</a></div></footer></body></html>